<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="UTF-8">
  <title data-i18n="myBookings">My Bookings</title>
  <link rel="stylesheet" href="manage_bookings.css">
  <script src="translations.js"></script>
  <script src="language.js" defer></script>
</head>

<body>

  <div class="container">
    <h1 data-i18n="myBookings">My Bookings</h1>
    <button class="refresh-btn" onclick="loadBookings()" data-i18n="refresh">ðŸ”„ Refresh</button>
    <ul id="bookingsList"></ul>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h2 data-i18n="reschedule">Reschedule</h2>
      <select id="newTimeSlot"></select>
      <div class="button-container">
        <button onclick="confirmEdit()" data-i18n="confirm">Confirm</button>
        <button onclick="closeModal()" data-i18n="cancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Toast Message -->
  <div id="toast"></div>

  <script>
    const bookingsList = document.getElementById("bookingsList");
    const editModal = document.getElementById("editModal");
    const newTimeSlot = document.getElementById("newTimeSlot");
    const toast = document.getElementById("toast");

    let editingBookingId = null;

    function getTranslation(key) {
      const lang = localStorage.getItem("preferredLanguage") || "en";
      return translations[lang][key] || key;
    }

    function loadBookings() {
      fetch("http://localhost:5000/my-bookings", {
        method: "GET",
        headers: {
          "Authorization": `Bearer ${sessionStorage.getItem("token")}`
        }
      })
        .then(response => response.json())
        .then(data => {
          bookingsList.innerHTML = "";
          data.forEach(booking => {
            const li = document.createElement("li");
            li.innerHTML = `
              <span>${booking.date} - ${booking.time}</span>
              <button onclick="openEditModal(${booking.id})" data-i18n="edit">Edit</button>
              <button onclick="cancelBooking(${booking.id})" data-i18n="cancel">Cancel</button>
            `;
            bookingsList.appendChild(li);
          });
        })
        .catch(error => console.error("Error loading bookings:", error));
    } // Closing the loadBookings function

    function closeModal() {
      editModal.style.display = "none";
      editingBookingId = null;
    }

    function showToast(message) {
      toast.innerText = message;
      toast.className = "show";
      setTimeout(() => {
        toast.className = toast.className.replace("show", "");
      }, 3000);
    }

    loadBookings();
    setInterval(loadBookings, 120000); // auto-refresh every 2 minutes
  </script>
</body>

</html>