<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trainer Dashboard</title>
  <link rel="stylesheet" href="trainer.css" />
</head>
<body>
  <div class="trainer-container">
    
    <h2>Trainer Dashboard</h2>

    <div class="button-container">
      <button onclick="loadTrainerPage('requests')">Requests</button>
      <button onclick="loadTrainerPage('clients')">Upcoming Clients</button>
       <button onclick="window.location.href='liveoccupancy-a.html'">Live Occupancy</button>

    </div>

    <div id="trainerContent"></div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>
  </div>

  <script>
    const trainerId = localStorage.getItem("user_id");

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    function loadTrainerPage(section) {
      const contentDiv = document.getElementById("trainerContent");
      contentDiv.innerHTML = "<p>Loading...</p>";

      if (section === "requests") {
        fetch(`http://localhost:5000/trainer-requests/${trainerId}`)
          .then(res => res.json())
          .then(data => {
            if (data.length === 0) {
              contentDiv.innerHTML = "<p>No pending requests.</p>";
              return;
            }

            const listItems = data.map(req => `
              <li>
                <strong>${req.full_name}</strong><br/>
                📅 <strong>${req.date}</strong> | 🕒 <strong>${req.time_slot}</strong><br/>
                ${req.request_detail ? `<em>${req.request_detail}</em><br/>` : ""}
                <div style="margin-top: 10px;">
                  <button onclick="respondRequest(${req.id}, true)">✅ Accept</button>
                  <button onclick="respondRequest(${req.id}, false)">❌ Deny</button>
                </div>
              </li>
            `).join("");

            contentDiv.innerHTML = `<h3>Client Requests</h3><ul>${listItems}</ul>`;
          });
      }

      if (section === "clients") {
        fetch(`http://localhost:5000/trainer-upcoming-clients/${trainerId}`)
          .then(res => res.json())
          .then(data => {
            if (data.length === 0) {
              contentDiv.innerHTML = "<p>No upcoming sessions.</p>";
              return;
            }

            const listItems = data.map(
              booking => `<li><strong>${booking.full_name}</strong><br/>📅 ${booking.date} at 🕒 ${booking.time_slot}</li>`
            ).join("");

            contentDiv.innerHTML = `<h3>Upcoming Clients</h3><ul>${listItems}</ul>`;
          });
      }

      if (section === "occupancy") {
        fetch("http://localhost:5000/live-occupancy")
          .then(res => res.json())
          .then(data => {
            contentDiv.innerHTML = `<h3>Live Occupancy</h3><p>Currently: <strong>${data.occupancy}</strong> / 25</p>`;
          });
      }
    }

    function respondRequest(id, approved) {
      fetch("http://localhost:5000/respond-request", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, approved })
      })
      .then(res => res.json())
      .then(data => {
        showToast(data.message);
        loadTrainerPage("requests");
      });
    }

    loadTrainerPage("requests"); // default load
  </script>
</body>
</html>
